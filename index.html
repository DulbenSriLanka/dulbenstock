<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Dulben Spices — Stock Manager (Home + Admin)</title>
<style>
  :root{
    --bg:#f8fafc; --card:#ffffff; --muted:#6b7280; --text:#0f1724;
    --accent:#ef4444; --accent-2:#f59e0b; --border:#e6eef3;
    --success:#10b981;
  }
  *{box-sizing:border-box;font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;}
  body{margin:0;background:var(--bg);color:var(--text);padding:18px;}
  .wrap{max-width:980px;margin:0 auto}
  header{display:flex;align-items:center;gap:14px;flex-wrap:wrap;margin-bottom:14px}
  .logo{width:54px;height:54px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#f43f5e);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700;font-size:20px}
  h1{margin:0;font-size:18px}
  .lead{margin:0;color:var(--muted);font-size:13px}
  .card{background:var(--card);padding:12px;border-radius:12px;box-shadow:0 4px 14px rgba(15,23,36,0.04);border:1px solid var(--border)}
  .controls{display:flex;gap:8px;align-items:center;margin-left:auto}
  button.btn{background:linear-gradient(90deg,var(--accent),#f97316);border:none;padding:8px 12px;border-radius:10px;color:white;cursor:pointer;font-weight:600}
  button.ghost{background:transparent;border:1px solid var(--border);padding:8px 12px;border-radius:10px;color:var(--muted);cursor:pointer}
  .search{padding:8px 12px;border-radius:10px;border:1px solid var(--border);background:#fff;color:inherit}
  .table-wrap{overflow-x:auto;margin-top:12px}
  table{width:100%;border-collapse:collapse;min-width:720px}
  th,td{padding:10px 8px;text-align:left;border-bottom:1px solid var(--border)}
  th{color:var(--muted);font-size:13px}
  .num{display:inline-block;min-width:44px;text-align:right;padding:6px 8px;border-radius:8px;background:#f3f4f6}
  .num.editable{background:#fff;border:1px dashed var(--border);cursor:text}
  .totals{margin-top:12px;display:flex;gap:12px;align-items:center;flex-wrap:wrap}
  .pill{background:linear-gradient(90deg,var(--accent-2),#84cc16);padding:8px 12px;border-radius:999px;color:#fff;font-weight:700}
  .muted{color:var(--muted)}
  .add-form{display:grid;grid-template-columns:1fr repeat(5,90px) 120px;gap:8px;align-items:center;margin-top:12px}
  .input{padding:8px;border-radius:8px;border:1px solid var(--border);background:#fff}
  .danger{background:transparent;border:1px solid var(--border);padding:6px;border-radius:8px;color:#dc2626;cursor:pointer}
  .row-actions{display:flex;gap:6px;align-items:center}
  /* manage panel */
  #managePanel{margin-top:12px;}
  .hidden{display:none}
  /* modal */
  .modal-back{position:fixed;inset:0;background:rgba(2,6,23,0.45);display:flex;align-items:center;justify-content:center;padding:18px;z-index:80}
  .modal{width:100%;max-width:420px;background:var(--card);padding:16px;border-radius:12px;border:1px solid var(--border);box-shadow:0 10px 30px rgba(2,6,23,0.18)}
  .center{display:flex;align-items:center;justify-content:center}
  /* responsive */
  @media (max-width:900px){
    .add-form{grid-template-columns:1fr 1fr;gap:8px}
    table{min-width:600px}
    .controls{width:100%;justify-content:flex-end}
  }
  footer{margin-top:16px;color:var(--muted);font-size:13px;text-align:center}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div style="display:flex;gap:12px;align-items:center">
      <div class="logo">DS</div>
      <div>
        <h1>Dulben Spices</h1>
        <div class="lead">Current stock — Read-only. Click Admin to manage stock.</div>
      </div>
    </div>

    <div class="controls" role="toolbar" aria-label="Controls">
      <input id="search" class="search" placeholder="Search product..." />
      <button id="adminBtn" class="ghost" title="Admin login">Admin</button>
      <button id="exportBtn" class="ghost">Export CSV</button>
    </div>
  </header>

  <!-- Read-only Home Card -->
  <section class="card" id="homeCard" aria-live="polite">
    <div style="display:flex;align-items:center;gap:10px;flex-wrap:wrap">
      <div class="muted">Overview</div>
      <div style="margin-left:auto" class="muted small">Tip: Admin mode allows editing</div>
    </div>

    <div class="table-wrap">
      <table id="homeTable" aria-describedby="homeDesc">
        <thead>
          <tr><th>Product</th><th>100g</th><th>250g</th><th>500g</th><th>1kg</th><th>Other</th><th>Total</th></tr>
        </thead>
        <tbody id="homeBody"></tbody>
      </table>
    </div>

    <div class="totals">
      <div class="pill" id="grandTotal">Total items: 0</div>
      <div id="lastSaved" class="muted">Not saved</div>
    </div>
  </section>

  <!-- Manage Panel (hidden until admin logs in) -->
  <section id="managePanel" class="card hidden" aria-hidden="true">
    <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px">
      <strong>Manage Mode</strong>
      <div class="muted">— Add, Edit, Stock Out, Delete</div>
      <div style="margin-left:auto">
        <button id="logoutBtn" class="ghost">Log out</button>
        <button id="saveBtn" class="btn">Save</button>
      </div>
    </div>

    <!-- editable table -->
    <div class="table-wrap">
      <table id="manageTable">
        <thead>
          <tr><th>Product</th><th>100g</th><th>250g</th><th>500g</th><th>1kg</th><th>Other</th><th style="min-width:120px">Actions</th></tr>
        </thead>
        <tbody id="manageBody"></tbody>
      </table>
    </div>

    <!-- add product form -->
    <form id="addForm" class="add-form" onsubmit="return false" aria-label="Add product form">
      <input id="newName" class="input" placeholder="New product name" required />
      <input id="v100" class="input" placeholder="100g" type="number" min="0" value="0"/>
      <input id="v250" class="input" placeholder="250g" type="number" min="0" value="0"/>
      <input id="v500" class="input" placeholder="500g" type="number" min="0" value="0"/>
      <input id="v1kg" class="input" placeholder="1kg" type="number" min="0" value="0"/>
      <input id="vother" class="input" placeholder="Other" type="number" min="0" value="0"/>
      <button id="addBtn" class="btn">Add</button>
    </form>
  </section>

  <footer>Data stored locally in this browser • Password required to access Manage Mode</footer>
</div>

<!-- Password modal -->
<div id="pwModal" class="modal-back hidden" role="dialog" aria-modal="true" aria-labelledby="pwTitle">
  <div class="modal">
    <h3 id="pwTitle">Admin login</h3>
    <p class="muted">Enter admin password to manage stock.</p>
    <div style="margin-top:12px;display:flex;gap:8px">
      <input id="pwInput" class="input" type="password" placeholder="Password" style="flex:1" />
      <button id="pwOk" class="btn">Login</button>
    </div>
    <div id="pwMsg" class="muted small" style="margin-top:8px"></div>
  </div>
</div>

<script>
/* ===== Initial data from user ===== */
const initialData = [
  {name:'Chili Powder', g100:14, g250:6, g500:0, kg1:1, other:0},
  {name:'Chili Pieces', g100:13, g250:4, g500:1, kg1:1, other:0},
  {name:'Curry Powder', g100:14, g250:4, g500:1, kg1:1, other:0},
  {name:'Rost Curry Powder', g100:14, g250:12, g500:0, kg1:0, other:0},
  {name:'Paper Powder', g100:14, g250:3, g500:0, kg1:0, other:0},
  {name:'Turmanic Powder', g100:15, g250:3, g500:0, kg1:0, other:0}
];

const LS_KEY = 'dulben_spices_v2';
const ADMIN_PW = '0101'; // as requested
let stock = [];
let isAdmin = false;

/* ===== Utilities ===== */
function loadData(){
  try{
    const raw = localStorage.getItem(LS_KEY);
    if(raw) stock = JSON.parse(raw);
    else stock = JSON.parse(JSON.stringify(initialData));
  }catch(e){ stock = JSON.parse(JSON.stringify(initialData)); }
}
function saveData(){
  localStorage.setItem(LS_KEY, JSON.stringify(stock));
  document.getElementById('lastSaved').textContent = 'Saved: ' + new Date().toLocaleString();
}
function totalRow(r){ return (Number(r.g100||0)+Number(r.g250||0)+Number(r.g500||0)+Number(r.kg1||0)+Number(r.other||0)); }
function grandTotal(){ return stock.reduce((s,r)=>s+totalRow(r),0); }
function escapeHtml(s){ return String(s).replace(/[&<>"']/g, m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

/* ===== Rendering ===== */
function renderHome(filter=''){
  const t = document.getElementById('homeBody');
  t.innerHTML = '';
  const q = (filter||'').toLowerCase().trim();
  stock.forEach((r, i) => {
    if(q){
      const match = r.name.toLowerCase().includes(q) ||
                    String(r.g100).includes(q) || String(r.g250).includes(q) ||
                    String(r.g500).includes(q) || String(r.kg1).includes(q) || String(r.other).includes(q);
      if(!match) return;
    }
    const tr = document.createElement('tr');
    tr.innerHTML = `<td><strong>${escapeHtml(r.name)}</strong></td>
      <td><div class="num">${r.g100||0}</div></td>
      <td><div class="num">${r.g250||0}</div></td>
      <td><div class="num">${r.g500||0}</div></td>
      <td><div class="num">${r.kg1||0}</div></td>
      <td><div class="num">${r.other||0}</div></td>
      <td><div>${totalRow(r)}</div></td>`;
    t.appendChild(tr);
  });
  document.getElementById('grandTotal').textContent = 'Total items: ' + grandTotal();
}

function renderManage(filter=''){
  const t = document.getElementById('manageBody');
  t.innerHTML = '';
  const q = (filter||'').toLowerCase().trim();
  stock.forEach((r,i)=>{
    if(q){
      const match = r.name.toLowerCase().includes(q) ||
                    String(r.g100).includes(q) || String(r.g250).includes(q) ||
                    String(r.g500).includes(q) || String(r.kg1).includes(q) || String(r.other).includes(q);
      if(!match) return;
    }
    const tr = document.createElement('tr');
    tr.innerHTML = `<td><input class="input" data-i="${i}" data-k="name" value="${escapeHtml(r.name)}" /></td>
      ${['g100','g250','g500','kg1','other'].map(k=>`<td><input class="input" type="number" min="0" data-i="${i}" data-k="${k}" value="${r[k]||0}"></td>`).join('')}
      <td>
        <div class="row-actions">
          <button class="ghost" onclick="openStockOut(${i})">Stock Out</button>
          <button class="danger" onclick="deleteRow(${i})">Delete</button>
        </div>
      </td>`;
    t.appendChild(tr);
  });
  // attach change handlers
  t.querySelectorAll('input.input').forEach(inp=>{
    inp.addEventListener('change', (e)=>{
      const i = +e.target.dataset.i, k = e.target.dataset.k;
      if(k === 'name') stock[i].name = e.target.value.trim() || 'Unnamed';
      else stock[i][k] = Math.max(0, parseInt(e.target.value||0));
      saveData(); renderHome(document.getElementById('search').value); renderManage(document.getElementById('search').value);
    });
  });
}

/* ===== Row actions ===== */
function deleteRow(idx){
  if(!confirm('Delete "'+stock[idx].name+'" ?')) return;
  stock.splice(idx,1);
  saveData(); renderHome(); renderManage();
}
function openStockOut(idx){
  const name = stock[idx].name;
  const qty = prompt(`Stock out (reduce) quantities for "${name}"\nEnter comma-separated numbers for 100g,250g,500g,1kg,other\nExample: 1,0,0,0,0  (will subtract 1 from 100g)`);
  if(qty === null) return;
  const parts = qty.split(',').map(s=>parseInt(s.trim()||0)).slice(0,5);
  if(parts.some(v=>isNaN(v) || v<0)){ alert('Invalid input'); return; }
  const keys = ['g100','g250','g500','kg1','other'];
  keys.forEach((k, i)=>{ stock[idx][k] = Math.max(0, (stock[idx][k]||0) - (parts[i]||0)); });
  saveData(); renderHome(); renderManage();
}

/* ===== Add product ===== */
document.getElementById('addBtn').addEventListener('click', ()=>{
  const name = (document.getElementById('newName').value || '').trim();
  if(!name){ alert('Enter product name'); return; }
  const g100 = Math.max(0, parseInt(document.getElementById('v100').value||0));
  const g250 = Math.max(0, parseInt(document.getElementById('v250').value||0));
  const g500 = Math.max(0, parseInt(document.getElementById('v500').value||0));
  const kg1 = Math.max(0, parseInt(document.getElementById('v1kg').value||0));
  const other = Math.max(0, parseInt(document.getElementById('vother').value||0));
  stock.push({name, g100, g250, g500, kg1, other});
  // reset
  document.getElementById('newName').value=''; document.getElementById('v100').value='0';
  document.getElementById('v250').value='0'; document.getElementById('v500').value='0';
  document.getElementById('v1kg').value='0'; document.getElementById('vother').value='0';
  saveData(); renderHome(); renderManage();
});

/* ===== Admin login flow ===== */
const pwModal = document.getElementById('pwModal');
document.getElementById('adminBtn').addEventListener('click', ()=>{
  document.getElementById('pwInput').value=''; document.getElementById('pwMsg').textContent='';
  pwModal.classList.remove('hidden');
  pwModal.querySelector('input')?.focus();
});
document.getElementById('pwOk').addEventListener('click', tryPw);
document.getElementById('pwInput').addEventListener('keydown', (e)=>{ if(e.key==='Enter') tryPw(); });

function tryPw(){
  const v = document.getElementById('pwInput').value || '';
  if(v === ADMIN_PW){
    isAdmin = true;
    pwModal.classList.add('hidden');
    showManage(true);
    document.getElementById('pwMsg').textContent='';
  } else {
    document.getElementById('pwMsg').textContent = 'Password wrong';
    setTimeout(()=>document.getElementById('pwInput').focus(),200);
  }
}
document.getElementById('logoutBtn').addEventListener('click', ()=>{
  if(confirm('Log out from Manage Mode?')){ isAdmin=false; showManage(false); }
});
/* close modal when clicking outside */
pwModal.addEventListener('click', (e)=>{ if(e.target === pwModal){ pwModal.classList.add('hidden'); } });

/* show/hide manage panel */
function showManage(show){
  const panel = document.getElementById('managePanel');
  panel.classList.toggle('hidden', !show);
  panel.setAttribute('aria-hidden', !show);
  // set focus
  if(show){
    renderManage(document.getElementById('search').value);
    document.getElementById('newName').focus();
  } else {
    renderHome(document.getElementById('search').value);
  }
}

/* ===== Search, export, save ===== */
document.getElementById('search').addEventListener('input', (e)=>{
  renderHome(e.target.value);
  if(isAdmin) renderManage(e.target.value);
});
document.getElementById('saveBtn').addEventListener('click', ()=>{ saveData(); alert('Saved'); });
document.getElementById('exportBtn').addEventListener('click', ()=>{
  const rows = [['Product','100g','250g','500g','1kg','Other','Total']];
  stock.forEach(r=> rows.push([r.name, r.g100||0, r.g250||0, r.g500||0, r.kg1||0, r.other||0, totalRow(r)]));
  const csv = rows.map(r=>r.map(c=>`"${String(c).replace(/"/g,'""')}"`).join(',')).join('\\n');
  const blob = new Blob([csv], {type:'text/csv'}); const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'dulben_spices_stock.csv'; a.click(); URL.revokeObjectURL(url);
});

/* ===== Init ===== */
loadData(); renderHome(); // manage hidden by default
// helpful: keyboard shortcut 'm' open admin modal (optional)
document.addEventListener('keydown', (e)=>{
  if(e.key === 'm' && !isAdmin) { document.getElementById('adminBtn').click(); }
});
</script>
</body>
</html>
