<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Dulben Spices — Stock Manager</title>
<style>
  :root{
    --bg:#0f1724; --card:#0b1220; --muted:#94a3b8; --accent:#ef4444;
    --accent-2:#fbbf24; --glass: rgba(255,255,255,0.04);
  }
  *{box-sizing:border-box;font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;}
  body{margin:0; background: linear-gradient(180deg,#071129 0%, #071a2b 100%); color:#e6eef6; padding:28px;}
  .wrap{max-width:1100px;margin:0 auto}
  header{display:flex;align-items:center;gap:16px;margin-bottom:18px}
  .brand{display:flex;gap:12px;align-items:center}
  .logo{width:56px;height:56px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#d63384);display:flex;align-items:center;justify-content:center;font-weight:700;font-size:20px;box-shadow: 0 6px 20px rgba(0,0,0,0.6)}
  h1{margin:0;font-size:20px}
  p.lead{margin:0;color:var(--muted);font-size:13px}
  .controls{margin-top:14px;display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  .card{background:var(--card);padding:14px;border-radius:12px;box-shadow: 0 6px 18px rgba(3,7,18,0.6);border:1px solid rgba(255,255,255,0.02)}
  .search{padding:8px 12px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:var(--glass);color:inherit}
  button.btn{background:linear-gradient(90deg,var(--accent),#f97316);border:none;padding:8px 12px;border-radius:10px;color:white;cursor:pointer;font-weight:600}
  button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px 12px;border-radius:10px;color:var(--muted);cursor:pointer}
  .tools{display:flex;gap:8px;margin-left:auto}
  table{width:100%;border-collapse:collapse;margin-top:12px;font-size:14px}
  th,td{padding:10px 8px;text-align:left;border-bottom:1px dashed rgba(255,255,255,0.03)}
  th{color:var(--muted);font-weight:600;font-size:13px}
  td .num{display:inline-block;min-width:44px;text-align:right;padding:6px 8px;border-radius:8px;background:rgba(255,255,255,0.02);cursor:pointer}
  td .num[contenteditable="true"]:focus{outline:2px solid rgba(99,102,241,0.14);background:rgba(255,255,255,0.03)}
  .small{font-size:12px;color:var(--muted)}
  .totals{margin-top:12px;display:flex;gap:12px;align-items:center}
  .pill{background:linear-gradient(90deg,var(--accent-2),#84cc16);padding:8px 12px;border-radius:999px;color:#071129;font-weight:700}
  .muted{color:var(--muted)}
  .row-actions{display:flex;gap:6px;align-items:center}
  .danger{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:6px;border-radius:8px;color:#ffb4b4;cursor:pointer}
  .add-form{display:grid;grid-template-columns:1fr repeat(5,110px) 120px;gap:8px;align-items:center;margin-top:12px}
  .input, input[type="text"]{padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
  @media (max-width:900px){
    .add-form{grid-template-columns:1fr 1fr; gap:8px}
    .tools{width:100%;margin-top:8px}
  }
  footer{margin-top:18px;color:var(--muted);font-size:13px;text-align:center}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="brand">
      <div class="logo">DS</div>
      <div>
        <h1>Dulben Spices — Stock Manager</h1>
        <p class="lead">Simple offline stock manager. Save changes locally (browser) • Export CSV • Print</p>
      </div>
    </div>
    <div class="tools" style="margin-left:auto">
      <input id="search" class="search" placeholder="Search product or size..." />
      <button class="ghost" id="resetBtn" title="Reset to initial data">Reset</button>
      <button class="ghost" id="saveBtn" title="Save to browser">Save</button>
      <button class="btn" id="exportBtn">Export CSV</button>
    </div>
  </header>

  <div class="card">
    <div style="display:flex;align-items:center;gap:12px;flex-wrap:wrap">
      <div class="small muted">Columns: product — 100g — 250g — 500g — 1kg — Other — Actions</div>
      <div style="margin-left:auto" class="small muted">Tip: Click a number to edit. Press Enter to commit.</div>
    </div>

    <table id="stockTable" class="card">
      <thead>
        <tr>
          <th style="width:34%">Product</th>
          <th>100g</th>
          <th>250g</th>
          <th>500g</th>
          <th>1kg</th>
          <th>Other</th>
          <th style="width:120px">Total</th>
        </tr>
      </thead>
      <tbody id="tableBody"></tbody>
    </table>

    <div class="totals">
      <div class="pill" id="grandTotal">Total items: 0</div>
      <div class="muted" id="lastSaved">Not saved</div>
    </div>

    <form id="addForm" class="add-form" onsubmit="return false">
      <input id="newName" class="input" placeholder="New product name (e.g., Black Pepper)" required />
      <input id="v100" class="input" placeholder="100g (qty)" type="number" min="0" value="0"/>
      <input id="v250" class="input" placeholder="250g (qty)" type="number" min="0" value="0"/>
      <input id="v500" class="input" placeholder="500g (qty)" type="number" min="0" value="0"/>
      <input id="v1kg" class="input" placeholder="1kg (qty)" type="number" min="0" value="0"/>
      <input id="vother" class="input" placeholder="Other packs (qty)" type="number" min="0" value="0"/>
      <div style="display:flex;gap:8px">
        <button id="addBtn" class="btn" style="width:100%">Add product</button>
      </div>
    </form>

  </div>

  <footer>
    <div>Preloaded from your list. Changes stored locally in this browser. If you want a sharable online version later I can prepare a GitHub Pages deploy.</div>
  </footer>
</div>

<script>
/* ===== Initial data filled from user's provided list =====
Chili Powder - 100g -14 / 250- 6 / 1kg-1
Chili Pieces  - 100g - 13 / 250g -4 / 500 - 1 / 1kg -1 
Curry Powder - 100g -14 / 250g - 4 / 500g - 1 / 1kg -1
Rost Curry Powder -100g -14 / 250g -12 
Paper Powder - 100g - 14 / 250g -3 
turmanic powder - 100g - 15 / 250g - 3
*/
const initialData = [
  {name:'Chili Powder', g100:14, g250:6, g500:0, kg1:1, other:0},
  {name:'Chili Pieces', g100:13, g250:4, g500:1, kg1:1, other:0},
  {name:'Curry Powder', g100:14, g250:4, g500:1, kg1:1, other:0},
  {name:'Rost Curry Powder', g100:14, g250:12, g500:0, kg1:0, other:0},
  {name:'Paper Powder', g100:14, g250:3, g500:0, kg1:0, other:0},
  {name:'Turmanic Powder', g100:15, g250:3, g500:0, kg1:0, other:0}
];

const LS_KEY = 'dulben_spices_stock_v1';
let stock = [];

/* Utilities */
function loadFromLocal(){
  try{
    const raw = localStorage.getItem(LS_KEY);
    if(raw){
      stock = JSON.parse(raw);
      showMessage('Loaded saved data');
      return;
    }
  }catch(e){ console.warn(e); }
  stock = JSON.parse(JSON.stringify(initialData));
  showMessage('Loaded initial data');
}
function saveToLocal(){
  localStorage.setItem(LS_KEY, JSON.stringify(stock));
  const tm = new Date().toLocaleString();
  document.getElementById('lastSaved').textContent = 'Saved: ' + tm;
  showMessage('Saved to browser');
}
function resetToInitial(){
  if(confirm('Reset to the original data you provided? This will overwrite saved changes in this browser.')) {
    stock = JSON.parse(JSON.stringify(initialData));
    saveToLocal();
    renderTable();
  }
}
function showMessage(msg){
  // light ephemeral flash in lastSaved area
  const el = document.getElementById('lastSaved');
  el.textContent = msg;
}

/* Rendering */
function calcTotalRow(r){
  return (Number(r.g100||0)+Number(r.g250||0)+Number(r.g500||0)+Number(r.kg1||0)+Number(r.other||0));
}
function calcGrandTotal(){
  return stock.reduce((s,r)=>s+calcTotalRow(r),0);
}

function renderTable(filterText=''){
  const tbody = document.getElementById('tableBody');
  tbody.innerHTML = '';
  const q = (filterText||'').toLowerCase().trim();
  stock.forEach((row, idx) => {
    if(q){
      const match = row.name.toLowerCase().includes(q) ||
                    String(row.g100).includes(q) ||
                    String(row.g250).includes(q) ||
                    String(row.g500).includes(q) ||
                    String(row.kg1).includes(q) ||
                    String(row.other).includes(q);
      if(!match) return;
    }
    const tr = document.createElement('tr');

    // product
    const tdName = document.createElement('td');
    tdName.innerHTML = `<strong>${escapeHtml(row.name)}</strong><div class="small muted">${row.name}</div>`;
    tr.appendChild(tdName);

    // sizes helper to create editable cell
    ['g100','g250','g500','kg1','other'].forEach((key)=>{
      const td = document.createElement('td');
      const span = document.createElement('div');
      span.className = 'num';
      span.contentEditable = true;
      span.dataset.row = idx;
      span.dataset.key = key;
      span.spellcheck = false;
      span.innerText = String(Number(row[key]||0));
      span.addEventListener('keydown', onNumKeyDown);
      span.addEventListener('blur', onNumBlur);
      td.appendChild(span);
      tr.appendChild(td);
    });

    // total
    const tdTotal = document.createElement('td');
    tdTotal.innerHTML = `<div style="font-weight:700">${calcTotalRow(row)}</div>
      <div class="row-actions small" style="margin-top:6px">
        <button class="ghost" title="Duplicate row" onclick="duplicateRow(${idx})">Duplicate</button>
        <button class="danger" title="Delete row" onclick="deleteRow(${idx})">Delete</button>
      </div>`;
    tr.appendChild(tdTotal);

    tbody.appendChild(tr);
  });

  document.getElementById('grandTotal').textContent = 'Total items: ' + calcGrandTotal();
}

/* editing handlers */
function onNumKeyDown(e){
  if(e.key === 'Enter'){
    e.preventDefault();
    e.target.blur();
  }
}
function onNumBlur(e){
  const el = e.target;
  const r = Number(el.dataset.row);
  const key = el.dataset.key;
  let v = el.innerText.replace(/[^\d-]/g, '').trim();
  if(v === '') v = '0';
  const num = parseInt(v,10);
  if(isNaN(num)){
    // revert
    el.innerText = String(Number(stock[r][key]||0));
    return;
  }
  stock[r][key] = num;
  saveToLocal();
  renderTable(document.getElementById('search').value);
}

/* row actions */
function deleteRow(idx){
  if(!confirm('Delete "'+stock[idx].name+'" ?')) return;
  stock.splice(idx,1);
  saveToLocal();
  renderTable(document.getElementById('search').value);
}
function duplicateRow(idx){
  const copy = JSON.parse(JSON.stringify(stock[idx]));
  copy.name = copy.name + ' (copy)';
  stock.splice(idx+1,0,copy);
  saveToLocal();
  renderTable(document.getElementById('search').value);
}

/* Add form */
document.getElementById('addBtn').addEventListener('click', ()=>{
  const name = (document.getElementById('newName').value || '').trim();
  if(!name){ alert('Enter a product name'); return; }
  const g100 = Number(document.getElementById('v100').value || 0);
  const g250 = Number(document.getElementById('v250').value || 0);
  const g500 = Number(document.getElementById('v500').value || 0);
  const kg1 = Number(document.getElementById('v1kg').value || 0);
  const other = Number(document.getElementById('vother').value || 0);
  stock.push({name, g100, g250, g500, kg1, other});
  document.getElementById('newName').value = '';
  document.getElementById('v100').value = '0';
  document.getElementById('v250').value = '0';
  document.getElementById('v500').value = '0';
  document.getElementById('v1kg').value = '0';
  document.getElementById('vother').value = '0';
  saveToLocal(); renderTable(document.getElementById('search').value);
});

/* Search */
document.getElementById('search').addEventListener('input', (e)=>{
  renderTable(e.target.value);
});

/* Buttons */
document.getElementById('saveBtn').addEventListener('click', ()=>{ saveToLocal(); });
document.getElementById('resetBtn').addEventListener('click', resetToInitial);

document.getElementById('exportBtn').addEventListener('click', ()=>{
  const rows = [['Product','100g','250g','500g','1kg','Other','Total']];
  stock.forEach(r=>{
    rows.push([r.name,r.g100||0,r.g250||0,r.g500||0,r.kg1||0,r.other||0,calcTotalRow(r)]);
  });
  const csv = rows.map(r=>r.map(c=>`"${String(c).replace(/"/g,'""')}"`).join(',')).join('\\n');
  const blob = new Blob([csv], {type:'text/csv'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = 'dulben_spices_stock.csv';
  document.body.appendChild(a); a.click(); a.remove();
  URL.revokeObjectURL(url);
});

/* Escape helper */
function escapeHtml(s){ return String(s).replace(/[&<>"']/g, function(m){ return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]; }); }

/* Init load */
loadFromLocal();
renderTable();

/* expose some functions to buttons in markup */
window.deleteRow = deleteRow;
window.duplicateRow = duplicateRow;

/* Make table sortable by clicking headers (simple) */
document.querySelectorAll('th').forEach((th, i) => {
  if(i===0) { th.style.cursor='pointer'; th.title='Sort by product'; }
  th.addEventListener('click', ()=>{
    const keyMap = ['name','g100','g250','g500','kg1','other','__total'];
    const key = keyMap[i] || 'name';
    stock.sort((a,b)=>{
      if(key==='__total') return calcTotalRow(b)-calcTotalRow(a);
      if(typeof a[key] === 'string') return a[key].localeCompare(b[key]);
      return (b[key]||0) - (a[key]||0);
    });
    renderTable(document.getElementById('search').value);
  });
});

/* Print friendly */
window.addEventListener('keydown', (e)=>{
  if((e.ctrlKey || e.metaKey) && e.key === 'p'){ /* allow browser print */ }
});
</script>
</body>
</html>
